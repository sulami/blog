<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Raspberry Pi: Radio-Alarm</title>
    <link rel="stylesheet" href="https://sulami.github.io/theme/css/main.css" />
    <link href="https://sulami.github.io/feed/rss.xml" type="application/rss+xml" rel="alternate" title="/dev/sulami >> blog RSS Feed" />

    <!--[if IE]>
        <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>

<body id="index" class="home">
    <header id="banner" class="body">
            <nav>
            <a href="https://sulami.github.io/">/dev/sulami >> blog</a> |
                <a href="https://sulami.github.io/pages/about-me.html">About me</a>
                <a href="https://sulami.github.io/category/coding.html">Coding</a>
                <a href="https://sulami.github.io/category/hardware.html">Hardware</a>
                <a href="https://sulami.github.io/category/linux.html">Linux</a>
                <a href="https://sulami.github.io/category/web.html">Web</a>
            <a href="https://sulami.github.io/feed/rss.xml">RSS</a>
            </nav>
    </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        >>
        <a href="https://sulami.github.io/raspberry-pi-radio-alarm.html" rel="bookmark"
           title="Permalink to Raspberry Pi: Radio-Alarm">Raspberry Pi: Radio-Alarm</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
    <span class="date">2013-06-07</span>
    |
    in <a href="https://sulami.github.io/category/linux.html">Linux</a>
    | tags: <a href="https://sulami.github.io/tag/cron.html">cron</a> <a href="https://sulami.github.io/tag/mplayer.html">mplayer</a> <a href="https://sulami.github.io/tag/raspberrypi.html">raspberrypi</a> </footer><!-- /.post-info -->
      <p>Some years ago I had the idea to use online radios as flexible alarm
clocks, but the main problem was having to run the computer all night
long, which results in high power consumption and noise. While netbooks
can counter this to a certain degree, the Raspberry Pi is the optimal
way of achieving our goal. You will need:</p>
<ul>
<li>Raspberry Pi model B (+ power cable, SD-card with OS)</li>
<li>speakers, preferably 3.5mm jack</li>
<li>network/internet access</li>
<li>control access directly or via ssh</li>
</ul>
<p>My RasPi is running <a href="http://www.raspberrypi.org/downloads" title="RasPi">Raspian</a> right now, but any Linux should do. You
connect everything and boot it up, then access a console. We need to
install mplayer, which will play our stream. If needed, update the
package lists before installing.</p>
<div class="codehilite"><pre><span class="cp"># Raspian:</span>
<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">mplayer</span>

<span class="cp"># ArchARM (as root):</span>
<span class="n">pacman</span> <span class="o">-</span><span class="n">Sy</span> <span class="n">mplayer</span>

<span class="cp"># Pidora:</span>
<span class="n">sudo</span> <span class="n">yum</span> <span class="n">install</span> <span class="n">mplayer</span>

<span class="cp"># openSUSE:</span>
<span class="n">sudo</span> <span class="n">zypper</span> <span class="n">in</span> <span class="n">mplayer</span>
</pre></div>


<p>Next thing to do is writing a short playlist. The idea is to have a
fallback if the internet connection or your radio station goes down, so
you can switch to a local file to play instead. Use any text editor you
want (vi, vim, emacs, nano, or graphical ones) to write something like
my <em>playlist.pls</em>:</p>
<div class="codehilite"><pre><span class="k">[playlist]</span>
<span class="na">File1</span><span class="o">=</span><span class="s">http://mp3.ht-stream.net</span>
<span class="na">Title1</span><span class="o">=</span><span class="s">HouseTime</span>
<span class="na">Lenght1</span><span class="o">=</span><span class="s">-1</span>
<span class="na">File2</span><span class="o">=</span><span class="s">/home/pi/alarm.mp3</span>
<span class="na">Title2</span><span class="o">=</span><span class="s">FallbackAlarm</span>
<span class="na">Length2</span><span class="o">=</span><span class="s">-1</span>
<span class="na">NumberOfEntries</span><span class="o">=</span><span class="s">2</span>
<span class="na">Version</span><span class="o">=</span><span class="s">1</span>
</pre></div>


<p>Mplayer will try to play File1, my stream, and if it fails, continue to
play File2, the fallback. You can also add more stations and files and
use the <em>-shuffle</em> parameter later on to play random music.</p>
<p>Now, ensure that cron is running ("<em>ps aux | grep cron</em>" should give you
a hint) and type "<em>crontab -e</em>" to enter your cronjob (preferably as a
non-root user). Depending on your OS there will be some comments you can
ignore. Add a entry like the following:</p>
<div class="codehilite"><pre><span class="mi">30</span> <span class="mi">6</span> <span class="o">*</span> <span class="o">*</span> <span class="o">*</span> <span class="n">env</span> <span class="n">DISPLAY</span><span class="o">=:</span><span class="mf">0.0</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">mplayer</span> <span class="o">-</span><span class="n">playlist</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">pi</span><span class="o">/</span><span class="n">playlist</span><span class="p">.</span><span class="n">pls</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
</pre></div>


<p>This will fire up mplayer everyday at 6:30 in the morning using the
provided playlist and then deletes the text-output. Using complete paths
is crucial here, cron does not use the \$PATH variable. If you read up
on cron, you can setup complete sets of alarms, depending on days of the
week and more. The env setting might be needed on some systems which
won't play and istead send you something like "connection by pulse
refused" per system-mail.Â Save the file to install the cronjob.</p>
<p>When waking up, you need to kill mplayer, as it is running in the
background. The easiest way of doing so is via "<em>killall mplayer</em>",
which is not the finest way of doing things but should do the job.</p>
    </div><!-- /.entry-content -->
  </article>
</section>
</body>
</html>
