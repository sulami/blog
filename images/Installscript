# Arch Install Script
# 2013-03-07

(loadkeys de-latin1)			# german
(c)fdisk				# make partitions
(shred -v <device>)			# overwrite disk

# encrypted lvm
	# make unencrypted boot-partition
	modprobe dm-crypt
	cryptsetup -c aes-xts-plain -y -s 512 luksFormat <device>
	cryptsetup luksOpen <device> lvm
	pvcreate /dev/mapper/lvm
	vgcreate <group> /dev/mapper/lvm
	lvcreate -L 20G -n <group> <name>
	lvcreate -l 100%FREE -n <group> <name>
	mkfs.ext4 /dev/mapper/<group>-<name>
	mount /dev/mapper/<group>-<name> /mnt
	mount /dev/mapper/<group>-<name> /mnt/whatever
	mount <device> /mnt/boot

# regular setup
	mkfs.ext4 <device>
	mount <device> /mnt

pacstrap /mnt base (base-devel)
genfstab -p /mnt >> /mnt/etc/fstab
arch-chroot /mnt
echo hostname > /etc/hostname			

# german
	echo LANG=de_DE.UTF-8 > /etc/locale.conf
	echo LC_COLLATE=C >> /etc/locale.conf
	echo KEYMAP=de-latin1 > /etc/vconsole.conf

# english
	echo LANG=ein_US.UTF-8 > /etc/locale.conf
	echo LC_COLLATE=C >> /etc/locale.conf
	echo KEYMAP=us > /etc/vconsole.conf

ln -s /usr/share/zoneinfo/Europe/Berlin /etc/localtime
nano /etc/hosts
nano /etc/locale.gen			# choose language
locale-gen
nano /etc/modules-load.d/modules.conf	# load custom modules
(nano /etc/pacman.conf)			# activate multilib

# encrypted lvm
	nano /etc/mkinitcpio.conf
	# MODULES="dm_mod ext4"
	# HOOKS="...block keyboard encrypt lvm2 filesystems..."

mkinitcpio -p linux
passwd					# set root password
(pacman -Sy)				# get multilib

# syslinux
	pacman -S syslinux
	nano /boot/syslinux/syslinux.cfg
	# regular
		APPEND root=<device> ro
	# encrypted lvm, one line
		APPEND root=/dev/mapper/<group>-<name>
		cryptdevice=<device>:<name>
	syslinux-install_update -iam
	cfdisk				# set boot-flag

# GRUB 2
	pacman -S grub-bios
	grub-mkconfig -o /boot/grub/grub.cfg
	grub-install <device>		# MBR

exit
umount <device>				# unmount everything
reboot

mkdir /home/<user>
chown <user> /home/user
passwd <user>

systemctl enable dhcpcd
systemctl start dhcpcd

# Xorg
pacman -S xorg-server xorg-server-utils xorg-xinit xorg-utils

# graphics driver packages
catalyst-kvm				# prop. AMD/ATI
xf86-video-ati				# oss AMD/ATI
xf86-video-intel			# Intel IGP
xf86-video-nv				# prop. Nvidia
xf86-video-noveau			# oss Nvidia
xf86-video-cirrus			# QEMU
xf86-video-vmware			# VMware
virtualbox-guest-utils			# VirtualBox
