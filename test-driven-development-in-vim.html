<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>Test-driven development in vim</title>
        <link rel="stylesheet" href="http://peerwire.de/theme/css/main.css" />
        <link href="http://peerwire.de/feed/atom.xml" type="application/atom+xml" rel="alternate" title="sulami's blog Atom Feed" />
        <link href="http://peerwire.de/feed/rss.xml" type="application/rss+xml" rel="alternate" title="sulami's blog RSS Feed" />

        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="http://peerwire.de/">sulami's blog </a></h1>
                <nav><ul>
                    <li><a href="http://peerwire.de/pages/about-me.html">About me</a></li>
                    <li class="active"><a href="http://peerwire.de/category/coding.html">Coding</a></li>
                    <li><a href="http://peerwire.de/category/games.html">Games</a></li>
                    <li><a href="http://peerwire.de/category/hardware.html">Hardware</a></li>
                    <li><a href="http://peerwire.de/category/linux.html">Linux</a></li>
                    <li><a href="http://peerwire.de/category/web.html">Web</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="http://peerwire.de/test-driven-development-in-vim.html" rel="bookmark"
           title="Permalink to Test-driven development in vim">Test-driven development in vim</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2014-05-05T14:50:00">
                Mo 05 Mai 2014
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="http://peerwire.de/author/sulami.html">sulami</a>
        </address>
<p>In <a href="http://peerwire.de/category/coding.html">Coding</a>. </p>
<p>tags: <a href="http://peerwire.de/tag/vim.html">vim</a><a href="http://peerwire.de/tag/cli.html">cli</a></p>
</footer><!-- /.post-info -->      <p><a href="https://en.wikipedia.org/wiki/Test-driven_development">Test-driven development (TDD)</a> is a way of developing software by using
tests over and over again. When I first was introduced to this concept, I
thought, automated tests are a nice idea, why not? Then I read a book about
TDD, which proceeded to explain how you start your project by writing a test
that (obviously) fails, then start your actual project, and test again. At this
point in time, we have a something that returns a default webpage, or zero. Not
even printing "Hello World" or "Success!". The next step is to write another
test, which checks for some actual content or functionality. After this test
fails (which by the way is important, as it shows that the test will hopefully
not produce false positives), we write the piece of content or functionality.</p>
<p>In the beginning, this way of writing code seems (and is) incredibly slow, and
I find myself skipping the first five tests until I have something that
actually produces useful output. This is sort of okay, I do not think it will
hurt my code in any major way. But after those initial skipped tests, say 10
minutes into the project, I start to religiously write tests for everything
that happens, which is way easier than implementing proper tests for all the
different stages and levels when you wrote code for several hours and start
wasting time by manually testing changes. I think, everything that takes more
than 30 minutes to code benefits from TDD.</p>
<p>But let's have a look at some actual TDD using vim and C. C is not often
written using TDD, but giving usually rather poor debugging output compared to
interpreted languages, TDD is even more useful, as you will instantaneously see
when a change breaks any functionality. To make testing easier, we will define
a keyboard mapping to start our tests from within vim.</p>
<div class="codehilite" style="background: #f0f0f0"><pre style="line-height: 125%"><span style="color: #902000">map</span> <span style="color: #666666">&lt;</span>Leader<span style="color: #666666">&gt;</span><span style="color: #007020">t</span> :<span style="color: #666666">!</span>make <span style="color: #4070a0">-B</span> tests <span style="color: #666666">&amp;&amp;</span> ./tests<span style="color: #666666">&lt;</span>CR<span style="color: #666666">&gt;</span>
</pre></div>


<p>This mapping will call make in a shell (which means you have to have make
installed), compile our <em>tests.c</em> file and run it. Depending on which language
you are using, which kind of application you are developing and how your tests
work, you might want to change this a bit. I am testing a library I am writing,
which gets included in <em>tests.c</em>.  The basic structure looks like this:</p>
<div class="codehilite" style="background: #f0f0f0"><pre style="line-height: 125%"><span style="color: #60a0b0; font-style: italic">/* Tests for my library */</span>
<span style="color: #007020">#include &lt;stdio.h&gt;</span>
<span style="color: #007020">#include &lt;assert.h&gt;</span>
<span style="color: #007020">#include &quot;mylib.h&quot;</span>

<span style="color: #007020">#define run_test(fn_name) \</span>
<span style="color: #007020">    printf(&quot;%s\n&quot;, #fn_name); \</span>
<span style="color: #007020">    fn_name();</span>

<span style="color: #902000">void</span> <span style="color: #06287e">test_example_test</span>() {
    <span style="color: #902000">int</span> test <span style="color: #666666">=</span> fancy_function(<span style="color: #40a070">42</span>);
    assert(test <span style="color: #666666">==</span> <span style="color: #40a070">15</span>);
}

<span style="color: #902000">int</span> <span style="color: #06287e">main</span>() {
    printf(<span style="color: #4070a0">&quot;</span><span style="color: #4070a0; font-weight: bold">\n</span><span style="color: #4070a0">Running tests:</span><span style="color: #4070a0; font-weight: bold">\n</span><span style="color: #4070a0">&quot;</span>);
    run_test(test_example_test);
    printf(<span style="color: #4070a0">&quot;</span><span style="color: #4070a0; font-weight: bold">\n</span><span style="color: #4070a0"> =&gt; All tests successful!</span><span style="color: #4070a0; font-weight: bold">\n</span><span style="color: #4070a0">&quot;</span>);
    <span style="color: #007020; font-weight: bold">return</span>(<span style="color: #40a070">0</span>);
}
</pre></div>


<p>We include <em>stdio</em> for printing and <em>assert</em> for the actual testing. The way
assert works is if the statement assert gets passed is false, which means it
can also be a function call, assert stops the whole program and prints out the
line which produced the error. If everything works as intended, it prints all
the tests it ran, prompts for enter and returns us to vim.  An important part
is to only delete old tests, when the condition they test for is no longer
wanted, so you always test for basic functionality as well as the final
results.</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="http://peerwire.de/feed/atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>
                            <li><a href="http://peerwire.de/feed/rss.xml" type="application/rss+xml" rel="alternate">rss feed</a></li>

                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-38330260-4']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
</body>
</html>